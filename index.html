<!doctype html>
<html lang="en">
    <head>
        <title>Rammerhead Proxy</title>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <!-- Use relative paths so it works both locally and on GitHub Pages (/rammerhead) -->
        <link rel="shortcut icon" href="favicon.png"/>
        <script defer="defer" src="static/js/main.ce3653a9.js"></script>
        <link href="static/css/main.fa2171d9.css" rel="stylesheet">
        <style>
            /* Simple styles - only hide the ad slot */
            .rhnewtab-header-ad-318332 {
                display: none !important;
            }
            
            /* Simple button style */
            .rammerhead-generate-link-btn {
                background: #4CAF50;
                border: none;
                border-radius: 6px;
                padding: 12px 24px;
                color: white;
                font-weight: 500;
                font-size: 14px;
                cursor: pointer;
                display: inline-flex;
                align-items: center;
                gap: 8px;
                margin: 20px auto;
            }
            
            .rammerhead-generate-link-btn:hover {
                background: #45a049;
            }
            
            .rammerhead-link-result {
                display: none;
                margin-top: 20px;
                padding: 16px;
                background: white;
                border-radius: 6px;
                border: 1px solid #ddd;
            }
            
            .rammerhead-link-result.active {
                display: block;
            }
            
            .rammerhead-link-url {
                font-family: monospace;
                font-size: 13px;
                color: #333;
                background: #f9f9f9;
                padding: 10px;
                border-radius: 4px;
                word-break: break-all;
                margin-bottom: 10px;
            }
            
            .rammerhead-copy-btn {
                background: #2196F3;
                border: none;
                border-radius: 4px;
                padding: 8px 16px;
                color: white;
                font-weight: 500;
                font-size: 13px;
                cursor: pointer;
            }
            
            .rammerhead-copy-btn:hover {
                background: #0b7dda;
            }
            
            .rammerhead-copy-btn.copied {
                background: #4CAF50;
            }
            
            .rammerhead-loading {
                display: none;
                text-align: center;
                margin-top: 20px;
                color: #666;
            }
            
            .rammerhead-loading.active {
                display: block;
            }
            
            .rammerhead-error {
                display: none;
                margin-top: 16px;
                padding: 12px;
                background: #ffebee;
                border: 1px solid #ef5350;
                border-radius: 4px;
                color: #c62828;
                font-size: 13px;
                text-align: center;
            }
        </style>
    </head>
    <body>
        <noscript>You're going to need to enable JavaScript to run this browser.</noscript>
        <div id="root"></div>
        <script>
            // Wait for React app to load, then modify the DOM
            (function() {
                function initRammerheadFeatures() {
                        // Remove unwanted ad/slot/ticket elements
                        function removeUnwantedElements() {
                            // Remove the specific ad slot element
                            const adSlot = document.querySelector('.rhnewtab-header-ad-318332');
                            if (adSlot) {
                                adSlot.remove();
                            }
                            
                            // Remove elements with specific text content
                            document.querySelectorAll('*').forEach(el => {
                                const text = (el.textContent || '').trim().toLowerCase();
                                if (text === 'open ad slot' || text === 'speed ticket') {
                                    el.remove();
                                }
                            });
                        }
                    
                    // Add Generate never-expire link button
                    function addGenerateLinkButton() {
                        // Check if button already exists
                        if (document.getElementById('rammerhead-generate-link-btn')) {
                            return;
                        }
                        
                        // Find a good place to insert the button (new tab page content)
                        const newTabContent = document.querySelector('.rhnewtab-261459') || 
                                             document.querySelector('[class*="newtab"]') ||
                                             document.querySelector('[class*="home"]') ||
                                             document.body;
                        
                        if (!newTabContent) return;
                        
                        // Create container
                        const container = document.createElement('div');
                        container.style.cssText = 'text-align: center; margin: 30px 0;';
                        container.innerHTML = `
                            <button id="rammerhead-generate-link-btn" class="rammerhead-generate-link-btn">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                                    <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                                </svg>
                                Generate never-expire link
                            </button>
                            <div id="rammerhead-link-result" class="rammerhead-link-result">
                                <div style="font-size: 0.8rem; color: #666; margin-bottom: 12px;">Never-expire link:</div>
                                <div id="rammerhead-link-url" class="rammerhead-link-url"></div>
                                <button id="rammerhead-copy-btn" class="rammerhead-copy-btn">Copy</button>
                            </div>
                            <div id="rammerhead-loading" class="rammerhead-loading">
                                <span style="display: inline-block; width: 14px; height: 14px; border: 2px solid rgba(255,255,255,0.3); border-top-color: #00d4aa; border-radius: 50%; animation: spin 0.6s linear infinite; margin-right: 8px;"></span>
                                Generating link...
                            </div>
                            <div id="rammerhead-error" class="rammerhead-error"></div>
                        `;
                        
                        // Add spin animation
                        if (!document.getElementById('rammerhead-spin-style')) {
                            const style = document.createElement('style');
                            style.id = 'rammerhead-spin-style';
                            style.textContent = '@keyframes spin { to { transform: rotate(360deg); } }';
                            document.head.appendChild(style);
                        }
                        
                        // Insert at the beginning or after first child
                        if (newTabContent.firstChild) {
                            newTabContent.insertBefore(container, newTabContent.firstChild);
                        } else {
                            newTabContent.appendChild(container);
                        }
                        
                        // Get current URL from address bar if available
                        function getCurrentUrl() {
                            const urlInput = document.querySelector('.addressbar-urlbar-283095') || 
                                           document.querySelector('input[type="text"]') ||
                                           document.querySelector('[contenteditable="true"]');
                            if (urlInput) {
                                return urlInput.textContent || urlInput.value || '';
                            }
                            return '';
                        }
                        
                        // Generate link functionality
                        document.getElementById('rammerhead-generate-link-btn').addEventListener('click', function() {
                            const url = getCurrentUrl() || window.location.href;
                            
                            if (!url || url === window.location.href) {
                                document.getElementById('rammerhead-error').textContent = 'Please navigate to a website first, or enter a URL in the address bar';
                                document.getElementById('rammerhead-error').style.display = 'block';
                                return;
                            }
                            
                            // Normalize URL
                            let targetUrl = url.trim();
                            if (!targetUrl.match(/^https?:\/\//i)) {
                                targetUrl = 'https://' + targetUrl;
                            }
                            
                            // Detect base path
                            const basePath = window.location.pathname.startsWith('/rammerhead') ? '/rammerhead' : '';
                            
                            document.getElementById('rammerhead-error').style.display = 'none';
                            document.getElementById('rammerhead-loading').classList.add('active');
                            document.getElementById('rammerhead-link-result').classList.remove('active');
                            
                            fetch(basePath + '/generatelink?url=' + encodeURIComponent(targetUrl))
                                .then(response => {
                                    if (!response.ok) {
                                        return response.json().then(data => {
                                            throw new Error(data.error || 'Failed to generate link');
                                        }).catch(() => {
                                            throw new Error('Server error: ' + response.status);
                                        });
                                    }
                                    return response.json();
                                })
                                .then(data => {
                                    if (data.error) {
                                        throw new Error(data.error);
                                    }
                                    document.getElementById('rammerhead-link-url').textContent = data.url;
                                    document.getElementById('rammerhead-link-result').classList.add('active');
                                    document.getElementById('rammerhead-loading').classList.remove('active');
                                    
                                    // Scroll to result
                                    document.getElementById('rammerhead-link-result').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                                })
                                .catch(error => {
                                    document.getElementById('rammerhead-error').textContent = 'Failed to generate link: ' + error.message;
                                    document.getElementById('rammerhead-error').style.display = 'block';
                                    document.getElementById('rammerhead-loading').classList.remove('active');
                                });
                        });
                        
                        // Copy button functionality
                        document.getElementById('rammerhead-copy-btn').addEventListener('click', function() {
                            const url = document.getElementById('rammerhead-link-url').textContent;
                            navigator.clipboard.writeText(url).then(() => {
                                this.textContent = 'Copied!';
                                this.classList.add('copied');
                                setTimeout(() => {
                                    this.textContent = 'Copy';
                                    this.classList.remove('copied');
                                }, 2000);
                            }).catch(() => {
                                // Fallback
                                const textarea = document.createElement('textarea');
                                textarea.value = url;
                                textarea.style.position = 'fixed';
                                textarea.style.opacity = '0';
                                document.body.appendChild(textarea);
                                textarea.select();
                                try {
                                    document.execCommand('copy');
                                    this.textContent = 'Copied!';
                                    this.classList.add('copied');
                                    setTimeout(() => {
                                        this.textContent = 'Copy';
                                        this.classList.remove('copied');
                                    }, 2000);
                                } catch(e) {
                                    document.getElementById('rammerhead-error').textContent = 'Failed to copy link';
                                    document.getElementById('rammerhead-error').style.display = 'block';
                                }
                                document.body.removeChild(textarea);
                            });
                        });
                    }
                    
                    // Run cleanup and add button
                    removeUnwantedElements();
                    addGenerateLinkButton();
                }
                
                // Try multiple times to catch React app when it loads
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', initRammerheadFeatures);
                } else {
                    initRammerheadFeatures();
                }
                
                // Also try after a delay to catch dynamically loaded content
                setTimeout(initRammerheadFeatures, 1000);
                setTimeout(initRammerheadFeatures, 3000);
                
                // Watch for DOM changes
                const observer = new MutationObserver(() => {
                    initRammerheadFeatures();
                });
                observer.observe(document.body, { childList: true, subtree: true });
            })();
        </script>
    </body>
</html>
